# 进程间通信的概述

------

进程是程序的一次执行，是系统资源分配的最小单元，不同进程间需要交换数据和消息，**进程间通信** 是我们给出的答案，IPC包括本地机制（如管道、共享内存、信号、消息队列等）或网络机制（Socket）

进程间通信有如下目的： 

> * A、数据传输：一个进程需要将它的数据发送给另一个进程，发送的数据量在一个字节到几M字节之间
> * B、共享数据：多个进程想要操作共享数据，一个进程对共享数据的修改，别的进程应该立刻看到。
> * C、通知事件：一个进程需要向另一个或一组进程发送消息，通知它（它们）发生了某种事件（如进程终止时要通知父进程）。
> * D、资源共享：多个进程之间共享同样的资源。为了作到这一点，需要内核提供锁和同步机制。
> * E、进程控制：有些进程希望完全控制另一个进程的执行（如Debug进程），此时控制进程希望能够拦截另一个进程的所有陷入和异常，并能够及时知道它的状态改变。

# 进程的隔离与通信
------
在早期的计算机中，程序是直接运行在物理内存上的，访问的都是物理地址。如果这个系统只运行一个程序，只要这个程序所需要的内存不要超过该机器的物理内存就不会出现问题，也就无需考虑内存管理。然而现在的系统都是支持多任务多进程的，这样CPU以及其他硬件的利用率会更高，但需要考虑如何将系统内有限的物理内存及时有效的分配给多个程序，即内存管理。现在内存管理的方法就是在程序和物理内存之间引入虚拟内存这个概念。虚拟内存违约程序和物理内存之间，程序只能看见虚拟内存，再也不能访问物理内存。每个程序都有自己的独立的进程地址空间，这样就做到了**进程隔离**。处于用户态的不同进程间是彼此隔离的，必须通过某种方式进行通信。

# 常用的IPC手段
Linux下的进程通信手段基本上是从Unix平台上的进程通信手段继承而来的。而对Unix发展做出重大贡献的两大主力AT&T的贝尔实验室及BSD（加州大学伯克利分校的伯克利软件发布中心）在进程间通信方面的侧重点有所不同。前者对Unix早期的进程间通信手段进行了系统的改进和扩充，形成了“system V IPC”，通信进程局限在单个计算机内；后者则跳过了该限制，形成了基于套接口（socket）的进程间通信机制。Linux则把两者继承了下来。
其中，最初Unix IPC包括：管道、FIFO、信号；System V IPC包括：System V消息队列、System V信号灯、System V共享内存区；Posix IPC包括： Posix消息队列、Posix信号灯、Posix共享内存区。

Linux下进程间通信的几种主要手段简介：
> *     1.管道（Pipe）：管道是一种半双工的通信方式，数据只能单向流动，匿名管道可用于具有亲缘关系进程间的通信，有名管道克服了管道没有名字的限制，因此，除具有管道所具有的功能外，它还允许无亲缘关系进程间的通信；
> *     2.信号（Signal）：信号是比较复杂的通信方式，用于通知接受进程有某种事件发生，除了用于进程间通信外，进程还可以发送信号给进程本 身；Linux除了支持Unix早期信号语义函数sigal外，还支持语义符合Posix.1标准的信号函数sigaction（实际上，该函数是基于 BSD的，BSD为了实现可靠信号机制，又能够统一对外接口，用sigaction函数重新实现了signal函数）； 信号是进程间唯一的异步通信机制，用于通知和接受进程有某种事件发生。
> *     3.消息队列：消息队列是消息的链接表，包括Posix消息队列systemV消息队列。有足够权限的进程可以向队列中添加消 息，被赋予读权限的进程则可以读走队列中的消息。消息队列克服了信号承载信息量少，管道只能承载无格式字节流以及缓冲区大小受限等缺点。
> *     4.共享内存：使得多个进程可以访问同一块内存空间，是最快的可用IPC方式。是针对其他通信机制运行效率较低而设计的。往往与其它通信机制，如信号量结合使用，来达到进程间的同步及互斥。
> *     5.信号量（semaphore）：信号量是一个计数器，可以来控制多个进程对共享资源的访问，它常作为一种锁机制，防止某进程正在访问共享资源时，其它进程也访问该资源，主要作为进程间以及同一进程不同线程之间的同步手段。
> *     6.套接字（Socket）：更为一般的进程间通信机制，可用于不同机器之间的进程间通信。起初是由Unix系统的BSD分支开发出来的，但现在一般可以移植到其它类Unix系统上：Linux和System V的变种都支持套接字。

# IPC手段的选择与取舍

|类型|无连接|可靠|流控制|记录|消息类型优先级|
|:--------:|:------:|:-----:|:------:|:-----:|:-----:|
|匿名PIPE | N | Y | Y |  | N |
|命名PIPE（FIFO）|N| Y | Y |  |N|
|消息队列|N| Y | Y |  |Y|
|信号量  |N| Y | Y |  |Y|
|共享内存|N| Y | Y |  |Y|
|UNIX流Socket|N| Y | Y |  |N|
|UNIX数据报Socket|Y| Y | N |  |N|
注：
无连接：指无需调用某种形式的OPEN就有发送消息的能力

流控制：如果系统资源短缺或者不能接收更多消息，则发送进程能进行流量控制

1、管道：速度慢，容量有限，字节流，没有消息边界，先进先出。只有父子进程能通信。较为简单，局限于单向通信的工作方式。

2、FIFO：任何进程间都能通信，字节流，没有消息边界，先进先出，但速度慢，长期存在于系统之中，使用不当容易出错。

3、消息队列：容量受到系统限制，通信时无需考虑同步问题，使用方便，但是消息的复制需要额外消耗CPU时间，不适宜于信息量大或者操作频繁的场合。当有一个消息放置到一个空队列中时,Posix消息队列可向一个进程发送一个信号,或者启动一个新的线程.System V则不提供类似的通知形式.消息由发送者赋予的优先级别。从一个Posix消息队列读出时,首先返回的总是优先级最高的消息.从一个System V消息队列读出时,读出者可以要求想要的任意优先级的消息.消息队列克服了信号传递信息少，管道只能承载无格式字节流以及缓存区大小受限等缺点。
4、信号量：不能传递复杂信息，只能用来同步。

5、共享内存：能够狠容易控制容量，速度快，但是要保持同步。

6、信号：如果用户传递的消息较少，或者是通过信号来触发某些行为。 信号是进程间唯一的异步通信机制，用于通知和接受进程有某种事件发生。


